@model List<Car_Rent.Models.Conversation>
@{
    ViewData["Title"] = "Hàng đợi chat";
    Layout = "~/Views/Shared/MainLayout.cshtml";
}
<div class="container py-4">
    <h3 class="mb-3">Hỗ trợ</h3>

    <h5 class="mt-3">Hàng đợi (chưa gán)</h5>
    <div class="table-responsive">
        <table class="table table-sm align-middle" id="queueTbl">
            <thead><tr><th>ID</th><th>Khách</th><th>Bắt đầu</th><th></th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <h5 class="mt-4">Khách của tôi (đang mở)</h5>
    <div class="table-responsive">
        <!-- Bảng khách của tôi (đã gán) -->
        <table class="table table-sm align-middle" id="assignedTbl">
            <thead><tr><th>ID</th><th>Khách</th><th>Cập nhật</th><th>Unread</th><th></th></tr></thead>
            <tbody>
                @* Nên server-render các conv đã gán cho staff để chắc chắn có hàng *@
                @foreach (var c in (IEnumerable<Car_Rent.Models.Conversation>)ViewBag.Assigned ?? new List<Car_Rent.Models.Conversation>())
                {
                    <tr id="a-@c.ConversationId">
                        <td>@c.ConversationId</td>
                        <td>@c.Customer?.Username (@c.CustomerId)</td>
                        <td>@c.LastMessageAt.ToLocalTime().ToString("HH:mm dd/MM")</td>
                        <td class="text-center" style="width:70px">
                            <span class="badge rounded-pill" data-unread="0"></span>
                        </td>
                        <td><a class="btn btn-success btn-sm" href="/Chat/Room?id=@c.ConversationId">Vào phòng</a></td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="~/js/chat.js"></script>
}




